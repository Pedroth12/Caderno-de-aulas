{
  "hash": "3212eaca93e66c1ecafe5a5cb2b9b929",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Aula 6 - Transformações, Modelos Mistos e Regressões Não Lineares\"\nauthor: \"Pedro Thiagos Santos Nogueira\"\ndate: \"2025-05-14\"\nformat: html\neditor: visual\n---\n\n\n\n## Aula 6 – 14/05/2025\n\n### Disciplina: FIP606 – Análise e Visualização de Dados em Fitopatologia\n\n**Professor:** Emerson Del Ponte\n\n#### ✦ Objetivos da aula:\n\n-   Aplicar transformações Box-Cox em dados não normais\n-   Ajustar modelos lineares por experimento\n-   Usar modelos mistos com estrutura hierárquica\n-   Visualizar interações entre tratamentos e experimentos\n-   Ajustar modelos de regressão não linear (dose-resposta)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ───────────────────────────────────────────────────────────────\n# Transformação Box-Cox em dados de contagem\n\nlibrary(MASS)\nlibrary(DHARMa)\nlibrary(epifitter)\nlibrary(tidyverse)\n\ninsects <- InsectSprays\n\n# Ajuste inicial e avaliação dos resíduos\nm1 <- lm(count ~ spray, data = insects)\nplot(simulateResiduals(m1))\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Box-Cox para determinar transformação ideal\nb <- boxcox(count + 0.1 ~ 1, data = insects)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-1-2.png){width=672}\n:::\n\n```{.r .cell-code}\nlambda <- b$x[which.max(b$y)]\nlambda\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.4242424\n```\n\n\n:::\n\n```{.r .cell-code}\n# Aplicando transformação e inspecionando\ninsects <- insects |> \n  mutate(count2 = (count^lambda - 1) / lambda,\n         count3 = sqrt(count))\n\nhist(insects$count2)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-1-3.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# ───────────────────────────────────────────────────────────────\n# Regressões por experimento (modelo separado por exp)\n\nlibrary(gsheet)\nlibrary(ggplot2)\n\nestande <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit?gid=401662555#gid=401662555\")\n\nestande |> \n  ggplot(aes(trat, nplants)) +\n  geom_point(width = 0.1) +\n  geom_smooth(method = \"lm\", se = FALSE, colour = \"darkgreen\") +\n  facet_wrap(~exp) +\n  theme_minimal() +\n  labs(x = \"Tratamento\", y = \"Número de plantas\")\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Modelos separados por experimento\nexp1 <- estande |> filter(exp == 1)\nm_exp1 <- lm(nplants ~ trat, data = exp1)\nsummary(m_exp1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp1)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-25.500  -6.532   1.758   8.573  27.226 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  52.5000     4.2044  12.487 1.84e-11 ***\ntrat         -0.2419     0.1859  -1.301    0.207    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 15 on 22 degrees of freedom\nMultiple R-squared:  0.07148,\tAdjusted R-squared:  0.02928 \nF-statistic: 1.694 on 1 and 22 DF,  p-value: 0.2066\n```\n\n\n:::\n\n```{.r .cell-code}\nexp2 <- estande |> filter(exp == 2)\nm_exp2 <- lm(nplants ~ trat + bloco, data = exp2)\nsummary(m_exp2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = nplants ~ trat + bloco, data = exp2)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-20.4399  -7.7581  -0.0514   6.5960  26.0393 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  49.2774     6.4366   7.656 1.65e-07 ***\ntrat         -0.7007     0.1489  -4.705 0.000121 ***\nbloco         4.6833     2.1939   2.135 0.044734 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 12.02 on 21 degrees of freedom\nMultiple R-squared:  0.5597,\tAdjusted R-squared:  0.5177 \nF-statistic: 13.35 on 2 and 21 DF,  p-value: 0.0001818\n```\n\n\n:::\n\n```{.r .cell-code}\nexp3 <- estande |> filter(exp == 3)\nm_exp3 <- lm(nplants ~ trat + bloco, data = exp3)\nsummary(m_exp3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = nplants ~ trat + bloco, data = exp3)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-25.7887  -3.8263   0.9285   5.0952  19.6285 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  97.0833     5.7654  16.839 1.13e-13 ***\ntrat         -0.7634     0.1334  -5.723 1.11e-05 ***\nbloco        -0.5333     1.9652  -0.271    0.789    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 10.76 on 21 degrees of freedom\nMultiple R-squared:  0.6098,\tAdjusted R-squared:  0.5727 \nF-statistic: 16.41 on 2 and 21 DF,  p-value: 5.106e-05\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# ───────────────────────────────────────────────────────────────\n# Modelo misto considerando exp e blocos como efeitos aleatórios\n\nlibrary(lme4)\n\nm_misto <- lmer(nplants ~ trat + (1 | exp/bloco), data = estande)\nconfint(m_misto)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                 2.5 %     97.5 %\n.sig01       3.3332097 14.4218422\n.sig02       7.2377419 47.8269818\n.sigma       9.7314178 13.9359486\n(Intercept) 43.4631239 96.0274587\ntrat        -0.7328972 -0.4044812\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(m_misto)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: nplants ~ trat + (1 | exp/bloco)\n   Data: estande\n\nREML criterion at convergence: 575.8\n\nScaled residuals: \n     Min       1Q   Median       3Q      Max \n-2.21697 -0.63351  0.04292  0.67094  1.92907 \n\nRandom effects:\n Groups    Name        Variance Std.Dev.\n bloco:exp (Intercept)  54.76    7.40   \n exp       (Intercept) 377.43   19.43   \n Residual              134.99   11.62   \nNumber of obs: 72, groups:  bloco:exp, 12; exp, 3\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept) 69.74524   11.57191   6.027\ntrat        -0.56869    0.08314  -6.840\n\nCorrelation of Fixed Effects:\n     (Intr)\ntrat -0.111\n```\n\n\n:::\n\n```{.r .cell-code}\ncar::Anova(m_misto)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: nplants\n      Chisq Df Pr(>Chisq)    \ntrat 46.788  1  7.909e-12 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# ───────────────────────────────────────────────────────────────\n# Visualização das interações experimento x tratamento\n\nestande |> \n  ggplot(aes(trat, nplants, colour = factor(exp))) +\n  geom_point() +\n  geom_abline(intercept = 69.74, slope = -0.568, linewidth = 2) +\n  geom_abline(intercept = 43, slope = -0.73, linetype = \"dashed\") +\n  geom_abline(intercept = 96, slope = -0.40, linetype = \"dashed\")\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# ───────────────────────────────────────────────────────────────\n# Regressão não linear – modelo de dose-resposta\n\nfungi <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit?gid=465348652#gid=465348652\")\n\nfungi |> \n  group_by(code, dose) |> \n  summarise(germination = mean(germination), .groups = \"drop\") |> \n  ggplot(aes(dose, germination)) +\n  geom_point(width = 0.1) +\n  geom_line() +\n  facet_wrap(~code)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Modelo para um isolado específico\nFGT43 <- fungi |> \n  group_by(code, dose) |> \n  summarise(germination = mean(germination), .groups = \"drop\") |> \n  filter(code == \"FGT43\")\n\nlibrary(drc)\nm43 <- drm(germination ~ dose, data = FGT43, fct = LL.3())\nAIC(m43)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 26.7762\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(m43)\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n\n```{.r .cell-code}\nED(m43, 50)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nEstimated effective doses\n\n       Estimate Std. Error\ne:1:50 0.495895   0.060851\n```\n\n\n:::\n\n```{.r .cell-code}\n# Estimativa de EC50 para todos os isolados\nlibrary(ec50estimator)\ndf_ec50 = estimate_EC50(germination ~ dose, \n                        data = fungi, \n                        isolate_col = \"code\", \n                        strata_col =  \"state\", \n                        interval = \"delta\", \n                        fct = drc::LL.3())\n\n# Visualização dos EC50 por isolado\n\ndf_ec50 |> \n  ggplot(aes(reorder(ID, Estimate), Estimate)) +\n  geom_point() +\n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-5-3.png){width=672}\n:::\n\n```{.r .cell-code}\ndf_ec50 |> \n  ggplot(aes(x = Estimate)) +\n  geom_boxplot() +\n  geom_histogram(bins = 5, color = \"white\")\n```\n\n::: {.cell-output-display}\n![](aula6_files/figure-html/unnamed-chunk-5-4.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}